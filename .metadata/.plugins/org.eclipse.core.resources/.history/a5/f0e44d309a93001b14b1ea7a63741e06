import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

public class ValidateSharedServlet extends HttpServlet {
	
	
    static private boolean isFirst = true;
    static private boolean flag = true;

	/**
		 * Constructor of the object.
		 */
	public ValidateSharedServlet() {
		super();
	}

	/**
		 * Destruction of the servlet. <br>
		 */
	public void destroy() {
		super.destroy(); // Just puts "destroy" string in log
		// Put your code here
	}

	/**
		 * The doGet method of the servlet. <br>
		 *
		 * This method is called when a form has its tag value method equals to get.
		 * 
		 * @param request the request send by the client to the server
		 * @param response the response send by the server to the client
		 * @throws ServletException if an error occurred
		 * @throws IOException if an error occurred
		 */
	public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

		response.setContentType("text/html;charset=GBK");
		PrintWriter out = response.getWriter();
		
		ServletContext servletContext = this.getServletContext();
		HttpSession httpSession = request.getSession();

		
        boolean ifsc = servletContext.getAttribute("value")!=null;
        boolean ifhs = httpSession.getAttribute("value")!=null;
        boolean ifres = request.getParameter("value")!=null;


        if(ifres && !ifsc && isFirst)
        {
        	servletContext.setAttribute("value", request.getParameter("value"));
        	httpSession.setAttribute("value", request.getParameter("value"));
            isFirst = false;
        }
        else if(ifsc && ifhs)
        {
        	httpSession.setMaxInactiveInterval(3);
        }

        out.println("<html>");
        out.println("<body link=\"red\" alink=\"red\">");

        if( !ifsc && !ifhs && !ifres )
        {
            out.println("<form action=\"/919106840420/servlet/ValidateSharedServlet/*\" method=\"get\">");
            out.println("请输入一段你喜欢的字符：<input type=\"text\" name=\"value\" />"+"<br/>");
            out.println("<br>");
            out.println("然后请点击这里---->>"+"<input type=\"submit\" value=\"提交\" />"+"</form>");
        }
        else
        {
            out.println("<table border=\"3\" width=\"400\" bordercolor=\"blue\">");
            out.println("<tr><td>ServletContext的对象里的值：</td><td>" + servletContext.getAttribute("value") + "</td></tr>");
            out.println("<tr><td>HttpSession的对象里的值：</td><td>" + httpSession.getAttribute("value") + "</td></tr>");
            out.println("<tr><td>HttpServletRequest的对象里的值：</td><td>" + request.getParameter("value") + "</td></tr>");
            out.println("</table>");
            response.setHeader("REFRESH", "3;URL=/919106840420/servlet/ValidateSharedServlet");
            if(request.getParameter("value")!=null)
            {
                out.println("你刚刚提交了一个表单，现在将HttpServletRequest的值给HttpSession和ServletContext并显示。");
                out.println("<br>");
                out.println("此页面将在3秒后刷新。。。。。。");
            }
            else if(httpSession.getAttribute("value")!=null)
            {
                out.println("因为HttpServletRequest传递的参数仅在一次请求中有效，所以现在它没了。");
                out.println("<br>");
                out.println("此页面将在3秒后刷新。。。。。。");
            }
            else
            {
                out.println("因为HttpSession的生命周期结束了，所以现在它也变成null了。");
                out.println("<br>");
                out.println("此页面将在3秒后刷新。。。。。。");

                if(!flag)
                {
                    out.println("<br>");
                    out.println("这时你会发现它没变化了。");
                    out.println("<br>");
                    out.println("你可以点击下方链接查看解释。");
                    out.println("<br>");
                    out.println("<a href = \"/919106840420/MyHtml.html\">点击此处查看ServletContext、HttpSession和HttpServletRequest作为容器对象的差异的解释</a>");
                }
                flag=false;

            }
        }

        out.println("</body>");
        out.println("</html>");
		
		
		out.flush();
		out.close();
	}

	/**
		 * Initialization of the servlet. <br>
		 *
		 * @throws ServletException if an error occurs
		 */
	public void init() throws ServletException {
		// Put your code here
	}

}
